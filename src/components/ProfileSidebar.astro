---
import { siteConfig } from '../config.js';
import Icon from './Icon.astro';
// You can customize these properties as needed
const { 
  name = "Your Name", 
  role = "PhD Student", 
  imageUrl = "/profile-placeholder.jpg",
  scholarUrl = siteConfig.author.scholarUrl,
  showScholar = siteConfig.socialLinks.showScholar,
  linkedinUrl = siteConfig.socialLinks.linkedinUrl,
  githubUrl = siteConfig.socialLinks.githubUrl,
  location = siteConfig.socialLinks.location
} = Astro.props;
---

<aside class="profile-sidebar">
  <div class="profile-container">
    <div class="profile-image-container">
      <div 
        class="profile-image"
        style={`background-image: url('${imageUrl}')`}
        data-original-bg={imageUrl}
        data-hover-bg="/profile-fun.gif"
        role="img"
        aria-label={`Photo of ${name}`}
      ></div>
    </div>
    <div class="profile-text">
      <h1 class="profile-name">{name}</h1>
      <p class="profile-role">{role}</p>
    </div>
    
    {/* Mobile icon links - shown inline with profile */}
    <div class="mobile-links-wrapper">
      {/* Priority 1: Google Scholar - always shown on mobile */}
      {showScholar && (
        <a href={scholarUrl} target="_blank" rel="noopener noreferrer" class="mobile-icon-link" title="Google Scholar">
          <Icon name="googlescholar" size="1.2em" />
        </a>
      )}
      
      {/* Priority 2: LinkedIn - shown if space available */}
      {linkedinUrl && (
        <a href={linkedinUrl} target="_blank" rel="noopener noreferrer" class="mobile-icon-link linkedin-icon" title="LinkedIn">
          <Icon name="linkedin" size="1.2em" />
        </a>
      )}
      
      {/* Priority 3: GitHub - shown if more space available */}
      {githubUrl && (
        <a href={githubUrl} target="_blank" rel="noopener noreferrer" class="mobile-icon-link github-icon" title="GitHub">
          <Icon name="github" size="1.2em" />
        </a>
      )}
    </div>
    
    <ul class="profile-links">
      {/* Google Scholar - visible on desktop */}
      {showScholar && (
        <li class="link-item">
          <a href={scholarUrl} target="_blank" rel="noopener noreferrer" class="profile-link">
            <Icon name="googlescholar" size="1.2em" /> <span class="link-text">Google Scholar</span>
          </a>
        </li>
      )}
      
      {/* Desktop-only links */}
      {linkedinUrl && (
        <li class="link-item desktop-only">
          <a href={linkedinUrl} target="_blank" rel="noopener noreferrer" class="profile-link">
            <Icon name="linkedin" size="1.2em" /> <span class="link-text">LinkedIn</span>
          </a>
        </li>
      )}
      
      {githubUrl && (
        <li class="link-item desktop-only">
          <a href={githubUrl} target="_blank" rel="noopener noreferrer" class="profile-link">
            <Icon name="github" size="1.2em" /> <span class="link-text">GitHub</span>
          </a>
        </li>
      )}
      
      {location && (
        <li class="link-item desktop-only">
          <div class="profile-link location-link">
            <Icon name="location" size="1.2em" /> <span class="link-text">{location}</span>
          </div>
        </li>
      )}
    </ul>
  </div>
</aside>

<style>
  .profile-sidebar {
    width: 280px;
    background: var(--bg);
    color: var(--text);
    padding: 2rem 1.5rem;
    display: flex;
    flex-direction: column;
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    z-index: 100;
    border-right: 1px solid var(--border);
    overflow-y: auto; /* Allow scrolling within sidebar if content is too tall */
  }
  
  .profile-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 0.8rem;
  }

  /* Profile header removed */

  .profile-image-container {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    overflow: hidden;
    border: 1px solid var(--border);
    margin-bottom: 0.8rem;
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .profile-image-container:hover {
    transform: scale(1.05);
  }

  .profile-image {
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    transition: all 0.3s ease;
  }

  .profile-text {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
  }
  
  .profile-name {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0.4rem 0;
    text-align: center;
  }

  .profile-role {
    font-size: 1rem;
    color: var(--text-muted);
    margin: 0 0 0.8rem;
    text-align: center;
  }

  .profile-links {
    list-style: none;
    padding: 0;
    margin: 0;
    width: 100%;
    text-align: center;
  }
  
  /* Add a subtle separator for the first desktop-only item */
  .desktop-only:first-of-type {
    position: relative;
    padding-top: 0.3rem;
    margin-top: 0.3rem;
  }
  
  .desktop-only:first-of-type::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 30px;
    height: 1px;
    background-color: var(--border);
    opacity: 0.5;
  }

  .link-item {
    margin-bottom: 0.4rem; /* Reduced spacing between items */
  }

  .link-item:last-child {
    margin-bottom: 0; /* No margin on last item */
  }

  .profile-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--link);
    text-decoration: none;
    transition: color 0.2s;
    padding: 0.15rem 0.5rem; /* Reduced vertical padding */
  }

  .profile-link:hover {
    color: var(--link-hover);
  }
  
  .location-link {
    color: var(--text-muted);
    cursor: default;
  }
  
  /* Hide mobile links wrapper on desktop */
  .mobile-links-wrapper {
    display: none;
  }

  @media (max-width: 768px) {
    .profile-sidebar {
      position: relative;
      width: 100%;
      padding: 0.75rem 0.5rem;
      border-bottom: 1px solid var(--border);
    }
    
    .profile-container {
      flex-direction: row;
      justify-content: flex-start;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.4rem;
      width: 100%;
      flex-wrap: nowrap;
    }
    
    .profile-image-container {
      width: 80px;
      height: 80px;
      margin-bottom: 0;
      flex-shrink: 0;
    }
    
    .profile-text {
      display: flex !important;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
      flex: 1 1 auto;
      min-width: 0; /* Allow text to shrink */
      visibility: visible;
      opacity: 1;
    }
    
    .profile-name {
      display: block !important;
      font-size: 1.1rem;
      margin: 0 0 0.15rem;
      text-align: left;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      width: 100%;
      color: var(--text);
      visibility: visible;
      opacity: 1;
    }
    
    .profile-role {
      display: block !important;
      font-size: 0.85rem;
      margin: 0;
      text-align: left;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      width: 100%;
      color: var(--text-muted);
      visibility: visible;
      opacity: 1;
    }
    
    /* Show mobile links wrapper inline with profile */
    .mobile-links-wrapper {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-left: auto;
      flex-shrink: 0;
      padding-left: 0.5rem;
    }
    
    .mobile-icon-link {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.3rem;
      color: var(--link);
      transition: color 0.2s;
      border-radius: 4px;
    }
    
    .mobile-icon-link:hover {
      color: var(--link-hover);
      background-color: rgba(128, 128, 128, 0.1);
    }
    
    .profile-links {
      display: none; /* Hide all profile links on mobile */
    }
    
    .desktop-only {
      display: none; /* Hide desktop-only links on mobile */
    }
  }
  
  /* Medium mobile - hide GitHub, show Scholar + LinkedIn */
  @media (max-width: 500px) {
    .github-icon {
      display: none;
    }
  }
  
  /* Small mobile - hide LinkedIn, show only Scholar */
  @media (max-width: 420px) {
    .linkedin-icon {
      display: none;
    }
  }
  
  /* Extra small devices */
  @media (max-width: 380px) {
    .profile-sidebar {
      padding: 0.5rem 0.25rem;
    }
    
    .profile-container {
      gap: 0.5rem;
    }
    
    .profile-image-container {
      width: 70px;
      height: 70px;
    }
    
    .profile-text {
      display: flex !important;
      visibility: visible;
      opacity: 1;
      min-width: 0;
    }
    
    .profile-name {
      display: block !important;
      font-size: 1rem;
      visibility: visible;
      opacity: 1;
    }
    
    .profile-role {
      display: block !important;
      font-size: 0.8rem;
      visibility: visible;
      opacity: 1;
    }
    
    .mobile-links-wrapper {
      padding-left: 0.3rem;
      gap: 0.3rem;
    }
    
    .mobile-icon-link {
      padding: 0.2rem;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const profileImage = document.querySelector('.profile-image');
    if (profileImage) {
      const originalBg = profileImage.getAttribute('data-original-bg');
      const hoverBg = profileImage.getAttribute('data-hover-bg');
      
      if (hoverBg) {
        // Preload the hover image/gif to prevent flickering
        const img = new Image();
        img.src = hoverBg;
        
        profileImage.addEventListener('mouseenter', () => {
          // For GIFs, we add a timestamp to force reload and restart animation
          const timestamp = new Date().getTime();
          profileImage.style.backgroundImage = `url('${hoverBg}?t=${timestamp}')`;
        });
        
        profileImage.addEventListener('mouseleave', () => {
          profileImage.style.backgroundImage = `url('${originalBg}')`;
        });
      }
    }
  });
</script>
