---
import Base from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog', ({data}) => !data.draft))
  .sort((a,b) => +b.data.pubDate - +a.data.pubDate);

const byYear = posts.reduce((acc,p)=>{
  const y = new Date(p.data.pubDate).getFullYear();
  (acc[y] ||= []).push(p);
  return acc;
}, {});
const years = Object.keys(byYear).sort((a,b)=> +b - +a);
---
<Base title="Posts by year">
  <h1>Posts by year</h1>
  {years.map(y => (
    <>
      <h2>{y}</h2>
      <ul>
        {byYear[y].map(p => (
          <li><a href={`/blog/${p.slug}/`}>{p.data.title}</a> â€” {p.data.pubDate.toDateString()}</li>
        ))}
      </ul>
    </>
  ))}
</Base>